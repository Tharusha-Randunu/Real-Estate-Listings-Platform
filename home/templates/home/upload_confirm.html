{% extends 'home/base.html' %}
{% load static %}

{% block title %}Upload and Confirm{% endblock %}

{% block content %}
<style>
    body {
        font-family: 'Poppins', sans-serif;
        background: #fdfdfd;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
    }

    h1 {
        color: #333;
        font-weight: 700;
        margin-bottom: 40px;
        text-align: center;
    }

    .form-section {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px 40px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        position: relative;
        z-index: 10;
    }

    .form-title {
        font-weight: 700;
        font-size: 1.2rem;
        margin-bottom: 15px;
    }

    .form-check-label {
        font-weight: 600;
        font-size: 0.95rem;
    }

    .btn-primary {
        border-radius: 25px;
    }

    .success-container {
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .success-box {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px 40px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 400px;
        width: 100%;
        position: relative;
        z-index: 10;
    }

    .success-box p {
        color: green;
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
    }

    .text-center {
        position: relative;
        z-index: 10;
    }

    .alert {
        position: relative;
        z-index: 10;
    }

    .floating-emoji {
        position: fixed;
        z-index: 1;
        font-size: 2rem;
        opacity: 0;
        animation: floatUp 12s linear forwards;
        pointer-events: none;
        filter: blur(0.2px);
    }

    @keyframes floatUp {
        0% {
            transform: translateY(100vh);
            opacity: 0;
        }
        10% {
            opacity: 0.4;
        }
        90% {
            opacity: 0.4;
        }
        100% {
            transform: translateY(-120vh);
            opacity: 0;
        }
    }

    @media (max-width: 768px) {
        h1 {
            font-size: 1.75rem;
        }
    }
</style>

<!-- Floating Emojis -->
<div id="emoji-container"></div>

{% if success %}
    <div class="success-container">
        <div class="success-box">
            <p>✅<br>Submitted Successfully! Your ad is pending review.</p>
        </div>
    </div>
{% else %}
    <div class="container my-5">
        <h1>Finalize Your Listing - Step 3</h1>

        <form action="{% url 'upload_confirm' %}" method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-section">
                <div class="form-title">Upload a Photo of Your Property <span class="text-danger">*</span></div>
                <input type="file" name="property_image" accept="image/*" class="form-control" required>
            </div>

            <div class="form-section">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirm" name="confirm" value="true" required>
                    <label class="form-check-label" for="confirm">
                        I confirm that I am the legal owner of this property or have received clear authorisation from the owner of the property to post this ad on behalf of them and understand that providing false information about the ownership is a criminal offence and can lead to prosecution. <span class="text-danger">*</span>
                    </label>
                </div>
            </div>

            {% if error %}
                <div class="alert alert-danger">{{ error }}</div>
            {% endif %}

            <div class="text-center">
                <button type="submit" class="btn btn-primary px-5 py-2">Submit Listing</button>
            </div>
        </form>
    </div>
{% endif %}

<script>
    const emojis = ['🏠','📺', '💰', '🏢', '📢', '📍', '🛏️', '🚪', '🔑','🏘️','🏡','🏢','🏨','🗺️','🌇️','🌆','🧭','🌍'];
    const emojiContainer = document.getElementById('emoji-container');

    function createEmoji() {
        const emoji = document.createElement('div');
        emoji.classList.add('floating-emoji');
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = `${Math.random() * 100}vw`;
        emoji.style.fontSize = `${1 + Math.random() * 2}rem`;
        emoji.style.animationDuration = `${20 + Math.random() * 2}s`;
        emojiContainer.appendChild(emoji);

        setTimeout(() => emoji.remove(), 18000);
    }

    setTimeout(() => {
        setInterval(createEmoji, 1200);
    }, 1500);
</script>
{% endblock %}
